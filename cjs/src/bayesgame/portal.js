"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("ethers"),e=require("./abi/Portal.json.js"),r=require("../common/transaction.js"),s=require("../common/signature-helper.js"),a=require("../common/format.js"),n=require("../contract.js"),i=require("./network.js");class c extends n.BaseContract{constructor(t,r){const s=i.getNetworkMeta(t.chainId);super(t,null!=r?r:s.Portal,e.default),this.contract=this.contract,this.networkMeta=s}async register(e,s,a,n){const i={value:t.BigNumber.from(0)};return r.getTransactionMethods(this.contract,"register",[e,s,a,n,i])}mintKey(e,s,a,n,i){const c={value:t.BigNumber.from(e)};return r.getTransactionMethods(this.contract,"mintKey",[s,a,n,i,c])}mintKeys(e,s,a,n,i){const c={value:t.BigNumber.from(e)};return r.getTransactionMethods(this.contract,"mintKeys",[s,a,n,i,c])}makeTicket(e){const s={value:t.BigNumber.from(0)};return r.getTransactionMethods(this.contract,"makeTicket",[e,s])}makeTickets(e){const s={value:t.BigNumber.from(0)};return r.getTransactionMethods(this.contract,"makeTickets",[e,s])}claimBonuses(t,e){return r.getTransactionMethods(this.contract,"claimBonuses",[t,e])}batchClaimBonuses(t,e){return r.getTransactionMethods(this.contract,"batchClaimBonuses",[t,e])}async relationships(t){return t||(t=await this.chain.getAccount()),await this.contract.relationships(t)}async keySize(){return await this.contract.keySize()}async keyPrice(){return await this.contract.keyPrice()}async inviterBonusesRate(){return(await this.contract.inviterBonusesRate()).div(1e4).toNumber()}async getPrizeRates(){return(await this.contract.getPrizeRates()).map((t=>t.toNumber()/1e4))}async checkRound(t){return await this.contract.checkRound(t)}async matchLevel(t,e){return await this.contract.matchLevel(t,e)}async queryBonuses(t,e){return await this.contract.queryBonuses(t,e)}async batchQueryBonuses(t,e){return await this.contract.queryBonuses(t,e)}async getCodes(t,e){return await this.contract.getCodes(t,e)}async getFormatCode(t){return await this.contract.getFormatCode(t)}async getFormatCodes(t,e){return await this.contract.getFormatCodes(t,e)}async getBalance(t){return await this.contract.getBalance(t)}async getRecord(t){return t=a.hexToBytes32(t),await this.contract.records(t)}async getRecords(t){const e=t.map((t=>a.hexToBytes32(t)));return await this.contract.getRecords(e)}setSigner(t){this.signer=t}async signRegisterData(t,e,r,n,i){if(!this.signer)throw new Error("no signer");n||(n=await this.chain.getAccount());const c=[t,e=a.hexToBytes32(e),r,n,this.chain.chainId,this.contract.address];return{user:n,inviter:t,sn:e,expired:r,signature:await s.getSignature(this.signer,["address","bytes32","uint256","address","uint256","address"],c,i)}}async signMintKeyData(t,e,r,n,i){if(!this.signer)throw new Error("no signer");n||(n=await this.chain.getAccount());const c=[t,e=a.hexToBytes32(e),r,n,this.chain.chainId,this.contract.address];return{user:n,random:t,sn:e,expired:r,signature:await s.getSignature(this.signer,["uint256","bytes32","uint256","address","uint256","address"],c,i)}}async signMintKeysData(t,e,r,n,i){if(!this.signer)throw new Error("no signer");n||(n=await this.chain.getAccount());const c=[t,e=a.hexToBytes32(e),r,n,this.chain.chainId,this.contract.address];return{user:n,randoms:t,sn:e,expired:r,signature:await s.getSignature(this.signer,["uint256[]","bytes32","uint256","address","uint256","address"],c,i)}}}exports.Portal=c,exports.getPortal=function(t,e){const r=i.getNetworkMeta(t.chainId);return e||(e=r.Portal.toLowerCase()),t.contractmaps[e.toLowerCase()]||new c(t,e),t.contractmaps[e.toLowerCase()]};
