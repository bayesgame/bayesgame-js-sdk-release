"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("ethers"),e=require("./abi/Portal.json.js"),r=require("../common/transaction.js"),a=require("../common/signature-helper.js"),n=require("../common/format.js"),s=require("../contract.js"),i=require("./network.js");class c extends s.BaseContract{constructor(t,r){const a=i.getNetworkMeta(t.chainId);super(t,r??a.Portal,e.default),this.contract=this.contract,this.networkMeta=a}async register(e,a,n,s){const i={value:t.BigNumber.from(0)};return r.getTransactionMethods(this.contract,"register",[e,a,n,s,i])}mintKey(e,a,n,s,i){const c={value:t.BigNumber.from(e)};return r.getTransactionMethods(this.contract,"mintKey",[a,n,s,i,c])}mintKeys(e,a,n,s,i){const c={value:t.BigNumber.from(e)};return r.getTransactionMethods(this.contract,"mintKeys",[a,n,s,i,c])}makeTicket(e){const a={value:t.BigNumber.from(0)};return r.getTransactionMethods(this.contract,"makeTicket",[e,a])}makeTickets(e){const a={value:t.BigNumber.from(0)};return r.getTransactionMethods(this.contract,"makeTickets",[e,a])}claimBonuses(t,e){return r.getTransactionMethods(this.contract,"claimBonuses",[t,e])}batchClaimBonuses(t,e){return r.getTransactionMethods(this.contract,"batchClaimBonuses",[t,e])}async relationships(t){return t||(t=await this.chain.getAccount()),await this.contract.relationships(t)}async keySize(){return await this.contract.keySize()}async keyPrice(){return await this.contract.keyPrice()}async totalRound(){return await this.contract.totalRound()}async maxMintSize(){return await this.contract.maxMintSize()}async maxMintRang(){return await this.contract.maxMintRang()}async roundExpired(){return await this.contract.roundExpired()}async inviterBonusesRate(){return(await this.contract.inviterBonusesRate()).div(1e4).toNumber()}async treasuryBonusesRate(){return(await this.contract.treasuryBonusesRate()).div(1e4).toNumber()}async getPrizeRates(){return(await this.contract.getPrizeRates()).map((t=>t.toNumber()/1e4))}async checkRound(t){return await this.contract.checkRound(t)}async matchLevel(t,e){return await this.contract.matchLevel(t,e)}async queryBonuses(t,e){return await this.contract.queryBonuses(t,e)}async batchQueryBonuses(t,e){return await this.contract.queryBonuses(t,e)}async getCodes(t,e){return await this.contract.getCodes(t,e)}async getFormatCode(t){return await this.contract.getFormatCode(t)}async getFormatCodes(t,e){return await this.contract.getFormatCodes(t,e)}async getBalance(t){return await this.contract.getBalance(t)}async getRecord(t){return t=n.hexToBytes32(t),await this.contract.records(t)}async getRecords(t){const e=t.map((t=>n.hexToBytes32(t)));return await this.contract.getRecords(e)}setSigner(t){this.signer=t}async signRegisterData(t,e,r,s,i){if(!this.signer)throw new Error("no signer");s||(s=await this.chain.getAccount());const c=[t,e=n.hexToBytes32(e),r,s,this.chain.chainId,this.contract.address];return{user:s,inviter:t,sn:e,expired:r,signature:await a.getSignature(this.signer,["address","bytes32","uint256","address","uint256","address"],c,i)}}async signMintKeyData(t,e,r,s,i){if(!this.signer)throw new Error("no signer");s||(s=await this.chain.getAccount());const c=[t,e=n.hexToBytes32(e),r,s,this.chain.chainId,this.contract.address];return{user:s,random:t,sn:e,expired:r,signature:await a.getSignature(this.signer,["uint256","bytes32","uint256","address","uint256","address"],c,i)}}async signMintKeysData(t,e,r,s,i){if(!this.signer)throw new Error("no signer");s||(s=await this.chain.getAccount());const c=[t,e=n.hexToBytes32(e),r,s,this.chain.chainId,this.contract.address];return{user:s,randoms:t,sn:e,expired:r,signature:await a.getSignature(this.signer,["uint256[]","bytes32","uint256","address","uint256","address"],c,i)}}}exports.Portal=c,exports.getPortal=function(t,e){const r=i.getNetworkMeta(t.chainId);return e||(e=r.Portal.toLowerCase()),t.contractmaps[e.toLowerCase()]||new c(t,e),t.contractmaps[e.toLowerCase()]};
