"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./common/abi/ERC721.js"),r=require("./common/transaction.js"),n=require("./contract.js");class e extends n.BaseContract{constructor(r,n,e=t.ERC721ABI){super(r,n,e),this.contract=this.contract}transferFrom(t,n,e){return r.getTransactionMethods(this.contract,"transferFrom",[t,n,e])}safeTransferFrom(t,n,e){return r.getTransactionMethods(this.contract,"safeTransferFrom(address,address,uint256)",[t,n,e])}approve(t,n){return r.getTransactionMethods(this.contract,"approve",[t,n])}setApprovalForAll(t,n){return r.getTransactionMethods(this.contract,"setApprovalForAll",[t,n])}async isApprovedForAll(t,r){return await this.contract.isApprovedForAll(t,r)}async info(){let t=this.chain.getToken(this.address);return t||(t=await this._info()),t}async name(){return(await this.info()).name}async symbol(){return(await this.info()).symbol}async balanceOf(t){return(await this.contract.balanceOf(t)).toString()}async tokenURI(t){try{return await this.contract.tokenURI(t)}catch(t){return console.warn("tokenURI except",t),""}}async ownerOf(t){return await this.contract.ownerOf(t)}async _info(){if(this.chain.isZeroAddress(this.address))throw new Error("invlaid erc721 address");const[t,r]=await Promise.all([this.contract.name(),this.contract.symbol()]),n={standard:"erc721",address:this.address,name:t,symbol:r,decimals:0};return this.chain.setToken(this.address,n),n}async getTransferEvent(t,r="latest"){const n=this.contract.filters.Transfer();return await this.contract.queryFilter(n,t,r)}approveEncodeFunction(t,r){return this.approve(t,r).encodeFunction()}setApprovalForAllEncodeFunction(t,r){return this.setApprovalForAll(t,r).encodeFunction()}transferFromEncodeFunction(t,r,n){return this.transferFrom(t,r,n).encodeFunction()}ownerOfEncodeFunction(t){return this.contract.interface.encodeFunctionData("ownerOf",[t])}isApprovedForAllEncodeFunction(t,r){return this.contract.interface.encodeFunctionData("isApprovedForAll",[t,r])}}exports.ERC721=e,exports.getERC721=function(t,r){return t.contractmaps[r.toLowerCase()]||new e(t,r),t.contractmaps[r.toLowerCase()]};
