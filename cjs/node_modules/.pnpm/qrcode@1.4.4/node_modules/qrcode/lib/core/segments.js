"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../../../../../../_virtual/segments.js");require("./mode.js");var t=require("./numeric-data.js"),r=require("./alphanumeric-data.js"),n=require("./byte-data.js"),a=require("./kanji-data.js");require("./regex.js"),require("./utils.js"),require("../../../../../dijkstrajs@1.0.3/node_modules/dijkstrajs/dijkstra.js");var u=require("../../../../../../../_virtual/utils2.js"),o=require("../../../../../../../_virtual/dijkstra.js"),d=require("../../../../../../../_virtual/mode.js"),s=require("../../../../../../../_virtual/regex.js");!function(e){var i=d.__exports,l=t.default,h=r.default,c=n.default,g=a.default,f=s.__exports,m=u.__exports,E=o.dijkstra.exports;function p(e){return unescape(encodeURIComponent(e)).length}function j(e,t,r){for(var n,a=[];null!==(n=e.exec(r));)a.push({data:n[0],index:n.index,mode:t,length:n[0].length});return a}function v(e){var t,r,n=j(f.NUMERIC,i.NUMERIC,e),a=j(f.ALPHANUMERIC,i.ALPHANUMERIC,e);return m.isKanjiModeEnabled()?(t=j(f.BYTE,i.BYTE,e),r=j(f.KANJI,i.KANJI,e)):(t=j(f.BYTE_KANJI,i.BYTE,e),r=[]),n.concat(a,t,r).sort((function(e,t){return e.index-t.index})).map((function(e){return{data:e.data,mode:e.mode,length:e.length}}))}function A(e,t){switch(t){case i.NUMERIC:return l.getBitsLength(e);case i.ALPHANUMERIC:return h.getBitsLength(e);case i.KANJI:return g.getBitsLength(e);case i.BYTE:return c.getBitsLength(e)}}function I(e,t){var r,n=i.getBestModeForData(e);if((r=i.from(t,n))!==i.BYTE&&r.bit<n.bit)throw new Error('"'+e+'" cannot be encoded with mode '+i.toString(r)+".\n Suggested mode is: "+i.toString(n));switch(r!==i.KANJI||m.isKanjiModeEnabled()||(r=i.BYTE),r){case i.NUMERIC:return new l(e);case i.ALPHANUMERIC:return new h(e);case i.KANJI:return new g(e);case i.BYTE:return new c(e)}}e.fromArray=function(e){return e.reduce((function(e,t){return"string"==typeof t?e.push(I(t,null)):t.data&&e.push(I(t.data,t.mode)),e}),[])},e.fromString=function(t,r){for(var n=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];switch(n.mode){case i.NUMERIC:t.push([n,{data:n.data,mode:i.ALPHANUMERIC,length:n.length},{data:n.data,mode:i.BYTE,length:n.length}]);break;case i.ALPHANUMERIC:t.push([n,{data:n.data,mode:i.BYTE,length:n.length}]);break;case i.KANJI:t.push([n,{data:n.data,mode:i.BYTE,length:p(n.data)}]);break;case i.BYTE:t.push([{data:n.data,mode:i.BYTE,length:p(n.data)}])}}return t}(v(t,m.isKanjiModeEnabled())),a=function(e,t){for(var r={},n={start:{}},a=["start"],u=0;u<e.length;u++){for(var o=e[u],d=[],s=0;s<o.length;s++){var l=o[s],h=""+u+s;d.push(h),r[h]={node:l,lastCount:0},n[h]={};for(var c=0;c<a.length;c++){var g=a[c];r[g]&&r[g].node.mode===l.mode?(n[g][h]=A(r[g].lastCount+l.length,l.mode)-A(r[g].lastCount,l.mode),r[g].lastCount+=l.length):(r[g]&&(r[g].lastCount=l.length),n[g][h]=A(l.length,l.mode)+4+i.getCharCountIndicator(l.mode,t))}}a=d}for(c=0;c<a.length;c++)n[a[c]].end=0;return{map:n,table:r}}(n,r),u=E.find_path(a.map,"start","end"),o=[],d=1;d<u.length-1;d++)o.push(a.table[u[d]].node);return e.fromArray(function(e){return e.reduce((function(e,t){var r=e.length-1>=0?e[e.length-1]:null;return r&&r.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)}),[])}(o))},e.rawSplit=function(t){return e.fromArray(v(t,m.isKanjiModeEnabled()))}}(e.__exports),exports.default=e.__exports;
