"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../../../../../../../_virtual/qrcode.js");require("../utils/buffer.js"),require("./utils.js"),require("./error-correction-level.js");var e=require("./bit-buffer.js"),t=require("./bit-matrix.js");require("./alignment-pattern.js"),require("./finder-pattern.js"),require("./mask-pattern.js"),require("./error-correction-code.js");var o=require("./reed-solomon-encoder.js");require("./version.js"),require("./format-info.js"),require("./mode.js"),require("./segments.js");var i=require("../../../../../isarray@2.0.5/node_modules/isarray/index.js"),s=require("../../../../../../../_virtual/utils2.js"),n=require("../../../../../../../_virtual/error-correction-level.js"),a=require("../../../../../../../_virtual/mask-pattern.js"),u=require("../../../../../../../_virtual/version.js"),f=require("../../../../../../../_virtual/segments.js"),l=require("../../../../../../../_virtual/buffer.js"),v=require("../../../../../../../_virtual/alignment-pattern.js"),d=require("../../../../../../../_virtual/finder-pattern.js"),c=require("../../../../../../../_virtual/error-correction-code.js"),_=require("../../../../../../../_virtual/format-info.js"),g=require("../../../../../../../_virtual/mode.js"),m=l.__exports,p=s.__exports,q=n.__exports,j=e.default,h=t.default,w=v.__exports,x=d.__exports,b=a.__exports,C=c.__exports,S=o.default,y=u.__exports,B=_.__exports,M=g.__exports,k=f.__exports,I=i.default;function E(r,e,t){var o,i,s=r.size,n=B.getEncodedBits(e,t);for(o=0;o<15;o++)i=1==(n>>o&1),o<6?r.set(o,8,i,!0):o<8?r.set(o+1,8,i,!0):r.set(s-15+o,8,i,!0),o<8?r.set(8,s-o-1,i,!0):o<9?r.set(8,15-o-1+1,i,!0):r.set(8,15-o-1,i,!0);r.set(s-8,8,1,!0)}function T(r,e,t){var o=new j;t.forEach((function(e){o.put(e.mode.bit,4),o.put(e.getLength(),M.getCharCountIndicator(e.mode,r)),e.write(o)}));var i=8*(p.getSymbolTotalCodewords(r)-C.getTotalCodewordsCount(r,e));for(o.getLengthInBits()+4<=i&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(0);for(var s=(i-o.getLengthInBits())/8,n=0;n<s;n++)o.put(n%2?17:236,8);return function(r,e,t){for(var o=p.getSymbolTotalCodewords(e),i=C.getTotalCodewordsCount(e,t),s=o-i,n=C.getBlocksCount(e,t),a=n-o%n,u=Math.floor(o/n),f=Math.floor(s/n),l=f+1,v=u-f,d=new S(v),c=0,_=new Array(n),g=new Array(n),q=0,j=m.from(r.buffer),h=0;h<n;h++){var w=h<a?f:l;_[h]=j.slice(c,c+w),g[h]=d.encode(_[h]),c+=w,q=Math.max(q,w)}var x,b,y=m.alloc(o),B=0;for(x=0;x<q;x++)for(b=0;b<n;b++)x<_[b].length&&(y[B++]=_[b][x]);for(x=0;x<v;x++)for(b=0;b<n;b++)y[B++]=g[b][x];return y}(o,r,e)}function z(r,e,t,o){var i;if(I(r))i=k.fromArray(r);else{if("string"!=typeof r)throw new Error("Invalid data");var s=e;if(!s){var n=k.rawSplit(r);s=y.getBestVersionForData(n,t)}i=k.fromString(r,s||40)}var a=y.getBestVersionForData(i,t);if(!a)throw new Error("The amount of data is too big to be stored in a QR Code");if(e){if(e<a)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+a+".\n")}else e=a;var u=T(e,t,i),f=p.getSymbolSize(e),l=new h(f);return function(r,e){for(var t=r.size,o=x.getPositions(e),i=0;i<o.length;i++)for(var s=o[i][0],n=o[i][1],a=-1;a<=7;a++)if(!(s+a<=-1||t<=s+a))for(var u=-1;u<=7;u++)n+u<=-1||t<=n+u||(a>=0&&a<=6&&(0===u||6===u)||u>=0&&u<=6&&(0===a||6===a)||a>=2&&a<=4&&u>=2&&u<=4?r.set(s+a,n+u,!0,!0):r.set(s+a,n+u,!1,!0))}(l,e),function(r){for(var e=r.size,t=8;t<e-8;t++){var o=t%2==0;r.set(t,6,o,!0),r.set(6,t,o,!0)}}(l),function(r,e){for(var t=w.getPositions(e),o=0;o<t.length;o++)for(var i=t[o][0],s=t[o][1],n=-2;n<=2;n++)for(var a=-2;a<=2;a++)-2===n||2===n||-2===a||2===a||0===n&&0===a?r.set(i+n,s+a,!0,!0):r.set(i+n,s+a,!1,!0)}(l,e),E(l,t,0),e>=7&&function(r,e){for(var t,o,i,s=r.size,n=y.getEncodedBits(e),a=0;a<18;a++)t=Math.floor(a/3),o=a%3+s-8-3,i=1==(n>>a&1),r.set(t,o,i,!0),r.set(o,t,i,!0)}(l,e),function(r,e){for(var t=r.size,o=-1,i=t-1,s=7,n=0,a=t-1;a>0;a-=2)for(6===a&&a--;;){for(var u=0;u<2;u++)if(!r.isReserved(i,a-u)){var f=!1;n<e.length&&(f=1==(e[n]>>>s&1)),r.set(i,a-u,f),-1==--s&&(n++,s=7)}if((i+=o)<0||t<=i){i-=o,o=-o;break}}}(l,u),isNaN(o)&&(o=b.getBestMask(l,E.bind(null,l,t))),b.applyMask(o,l),E(l,t,o),{modules:l,version:e,errorCorrectionLevel:t,maskPattern:o,segments:i}}r.__exports.create=function(r,e){if(void 0===r||""===r)throw new Error("No input text");var t,o,i=q.M;return void 0!==e&&(i=q.from(e.errorCorrectionLevel,q.M),t=y.from(e.version),o=b.from(e.maskPattern),e.toSJISFunc&&p.setToSJISFunction(e.toSJISFunc)),z(r,t,i,o)},exports.default=r.__exports;
