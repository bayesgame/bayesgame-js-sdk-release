"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../../../../../_virtual/packer.js"),e=require("./constants.js");require("./crc.js");var r=require("./bitpacker.js"),o=require("./filter-pack.js"),p=require("zlib"),n=require("../../../../../../_virtual/crc.js");function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var a=i(p),l=e.default,u=n.crc.exports,s=r.default,c=o.default,f=a.default,h=t.packer.exports=function(t){if(this._options=t,t.deflateChunkSize=t.deflateChunkSize||32768,t.deflateLevel=null!=t.deflateLevel?t.deflateLevel:9,t.deflateStrategy=null!=t.deflateStrategy?t.deflateStrategy:3,t.inputHasAlpha=null==t.inputHasAlpha||t.inputHasAlpha,t.deflateFactory=t.deflateFactory||f.createDeflate,t.bitDepth=t.bitDepth||8,t.colorType="number"==typeof t.colorType?t.colorType:l.COLORTYPE_COLOR_ALPHA,t.inputColorType="number"==typeof t.inputColorType?t.inputColorType:l.COLORTYPE_COLOR_ALPHA,-1===[l.COLORTYPE_GRAYSCALE,l.COLORTYPE_COLOR,l.COLORTYPE_COLOR_ALPHA,l.COLORTYPE_ALPHA].indexOf(t.colorType))throw new Error("option color type:"+t.colorType+" is not supported at present");if(-1===[l.COLORTYPE_GRAYSCALE,l.COLORTYPE_COLOR,l.COLORTYPE_COLOR_ALPHA,l.COLORTYPE_ALPHA].indexOf(t.inputColorType))throw new Error("option input color type:"+t.inputColorType+" is not supported at present");if(8!==t.bitDepth&&16!==t.bitDepth)throw new Error("option bit depth:"+t.bitDepth+" is not supported at present")};h.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},h.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},h.prototype.filterData=function(t,e,r){var o=s(t,e,r,this._options),p=l.COLORTYPE_TO_BPP_MAP[this._options.colorType];return c(o,e,r,this._options,p)},h.prototype._packChunk=function(t,e){var r=e?e.length:0,o=new Buffer(r+12);return o.writeUInt32BE(r,0),o.writeUInt32BE(t,4),e&&e.copy(o,8),o.writeInt32BE(u.crc32(o.slice(4,o.length-4)),o.length-4),o},h.prototype.packGAMA=function(t){var e=new Buffer(4);return e.writeUInt32BE(Math.floor(t*l.GAMMA_DIVISION),0),this._packChunk(l.TYPE_gAMA,e)},h.prototype.packIHDR=function(t,e){var r=new Buffer(13);return r.writeUInt32BE(t,0),r.writeUInt32BE(e,4),r[8]=this._options.bitDepth,r[9]=this._options.colorType,r[10]=0,r[11]=0,r[12]=0,this._packChunk(l.TYPE_IHDR,r)},h.prototype.packIDAT=function(t){return this._packChunk(l.TYPE_IDAT,t)},h.prototype.packIEND=function(){return this._packChunk(l.TYPE_IEND,null)},exports.default=t.packer.exports;
