"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../../../../../_virtual/packer-async.js"),t=require("util"),a=require("stream"),r=require("./constants.js");require("./packer.js");var i=require("../../../../../../_virtual/packer.js");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=s(t),n=s(a),p=c.default,d=n.default,h=r.default,u=i.packer.exports,f=e.packerAsync.exports=function(e){d.call(this);var t=e||{};this._packer=new u(t),this._deflate=this._packer.createDeflate(),this.readable=!0};p.inherits(f,d),f.prototype.pack=function(e,t,a,r){this.emit("data",new Buffer(h.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(t,a)),r&&this.emit("data",this._packer.packGAMA(r));var i=this._packer.filterData(e,t,a);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",function(e){this.emit("data",this._packer.packIDAT(e))}.bind(this)),this._deflate.on("end",function(){this.emit("data",this._packer.packIEND()),this.emit("end")}.bind(this)),this._deflate.end(i)},exports.default=e.packerAsync.exports;
