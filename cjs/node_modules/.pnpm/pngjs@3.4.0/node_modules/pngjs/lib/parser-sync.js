"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("zlib");require("./sync-inflate.js"),require("./sync-reader.js"),require("./filter-parse-sync.js"),require("./parser.js"),require("./bitmapper.js");var r=require("./format-normaliser.js"),a=require("../../../../../../_virtual/sync-reader.js"),t=require("../../../../../../_virtual/filter-parse-sync.js"),n=require("../../../../../../_virtual/bitmapper.js"),i=require("../../../../../../_virtual/sync-inflate.js"),s=require("../../../../../../_virtual/parser.js");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=!0,u=l(e).default,p=i.syncInflate.exports;u.deflateSync||(o=!1);var f=a.syncReader.exports,c=t.__exports,d=s.parser.exports,v=n.__exports,y=r.default;exports.default=function(e,r){if(!o)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var a,t,n;var i=[];var s=new f(e),l=new d(r,{read:s.read.bind(s),error:function(e){a=e},metadata:function(e){t=e},gamma:function(e){n=e},palette:function(e){t.palette=e},transColor:function(e){t.transColor=e},inflateData:function(e){i.push(e)},simpleTransparency:function(){t.alpha=!0}});if(l.start(),s.process(),a)throw a;var h,j=Buffer.concat(i);if(i.length=0,t.interlace)h=u.inflateSync(j);else{var q=(1+(t.width*t.bpp*t.depth+7>>3))*t.height;h=p(j,{chunkSize:q,maxLength:q})}if(j=null,!h||!h.length)throw new Error("bad png - invalid inflate data response");var m=c.process(h,t);j=null;var _=v.dataToBitMap(m,t);m=null;var b=y(_,t);return t.data=b,t.gamma=n||0,t};
