"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r,e=require("../../../../../../../../_virtual/index3.js"),t=require("../../../../../../../../_virtual/__tslib.js"),o=require("../../../../../../@walletconnect_crypto@1.0.3/node_modules/@walletconnect/crypto/dist/cjs/node/index.js"),i=require("../../../../../../../../_virtual/index4.js"),a=require("../../../../../../@walletconnect_utils@1.8.0/node_modules/@walletconnect/utils/dist/cjs/index.js");exports.__require=function(){if(r)return e.__exports;r=1,Object.defineProperty(e.__exports,"__esModule",{value:!0}),e.__exports.decrypt=e.__exports.encrypt=e.__exports.verifyHmac=e.__exports.generateKey=void 0;const n=t.default,u=n.__importStar(o.__require()),c=n.__importStar(i.default),_=a.__require();function s(r){return n.__awaiter(this,void 0,void 0,(function*(){const e=(r||256)/8,t=u.randomBytes(e);return(0,_.convertBufferToArrayBuffer)(c.arrayToBuffer(t))}))}function f(r,e){return n.__awaiter(this,void 0,void 0,(function*(){const t=c.hexToArray(r.data),o=c.hexToArray(r.iv),i=c.hexToArray(r.hmac),a=c.arrayToHex(i,!1),n=c.concatArrays(t,o),_=yield u.hmacSha256Sign(e,n),s=c.arrayToHex(_,!1);return c.removeHexPrefix(a)===c.removeHexPrefix(s)}))}return e.__exports.generateKey=s,e.__exports.verifyHmac=f,e.__exports.encrypt=function(r,e,t){return n.__awaiter(this,void 0,void 0,(function*(){const o=c.bufferToArray((0,_.convertArrayBufferToBuffer)(e)),i=t||(yield s(128)),a=c.bufferToArray((0,_.convertArrayBufferToBuffer)(i)),n=c.arrayToHex(a,!1),f=JSON.stringify(r),y=c.utf8ToArray(f),d=yield u.aesCbcEncrypt(a,o,y),l=c.arrayToHex(d,!1),x=c.concatArrays(d,a),p=yield u.hmacSha256Sign(o,x);return{data:l,hmac:c.arrayToHex(p,!1),iv:n}}))},e.__exports.decrypt=function(r,e){return n.__awaiter(this,void 0,void 0,(function*(){const t=c.bufferToArray((0,_.convertArrayBufferToBuffer)(e));if(!t)throw new Error("Missing key: required for decryption");if(!(yield f(r,t)))return null;const o=c.hexToArray(r.data),i=c.hexToArray(r.iv),a=yield u.aesCbcDecrypt(i,t,o),n=c.arrayToUtf8(a);let s;try{s=JSON.parse(n)}catch(r){return null}return s}))},e.__exports};
